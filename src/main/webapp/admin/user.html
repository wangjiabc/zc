<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta content="" name="description"/>
    <meta content="webthemez" name="author"/>
    <title>用户管理</title>
    <script src="../assets/js/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="../assets/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="../assets/bootstrap-table/bootstrap-editable.css">
    <script src="../assets/bootstrap-table/jquery.min.js"></script>
    <script src="../assets/bootstrap-table/bootstrap.min.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-table.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-table-export.js"></script>
    <script src="../assets/bootstrap-table/tableExport.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-table-editable.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-editable.js"></script>
    <script src="../js/bootstrap-table-zh-CN.min.js"></script>
    <!--<script type="text/javascript" src="./bootstrap/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>-->
    <script type="text/javascript" src="../admin.js"></script>
    <!-- Bootstrap Styles-->
    <link href="../assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="../assets/css/checkbox3.min.css" rel="stylesheet">
    <!-- Morris Chart Styles-->
    <link href="../assets/js/morris/morris-0.4.3.min.css" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="../assets/css/custom-styles1.css" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../assets/js/Lightweight-Chart/cssCharts.css">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/json2/20140204/json2.min.js"></script>
    <![endif]-->

</head>
<body>
<section class="content">
    <!-- /. PAGE WRAPPER  -->
    <div class="header">
        <h1 class="page-header">员工权限管理</h1>
    </div>
    <div id="page-inner">
        <div class="row">
            <div class="col-xs-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="card-title">
                            <div class="title">用户权限管理</div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                      <div id="toolbar" class="btn-group">                         
                            <button id="edit" type="button" class="btn btn-default">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
                            </button>
                            <button id="delete" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>删 除
                             </button>
                        </div>
                            <table id="table" class="table " data-toggle="table" data-toolbar="#toolbar"
                               data-url="/zc/user/getAllUser.do" data-search="true"
                               data-show-refresh="true" data-show-toggle="true"
                               data-side-pagination="server" data-pagination="true"
                               data-show-columns="true" data-sort-order="desc">
                                <thead>
                                <tr>
                                    <th  data-checkbox="true"></th>
                                    <th data-align="left" data-field="campusAdmin">帐号</th>
                                    <th data-align="left" data-field="name">姓名</th>
                                    <th data-align="left" data-field="telePhone">手机号</th>
                                    <th data-align="left" data-field="address">家庭住址</th>
                                    <th data-align="left" data-field="lastLoginDate" data-formatter="actionTime">最后登陆时间</th>
                                    <th data-align="left" data-field="state" data-formatter="actionStatus">登陆权限</th>
                                    <th data-field="action" data-formatter="actionFormatter"
                                        data-events="actionEvents">权限修改
                                    </th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!--员工修改对话框-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">员工修改</div>
            <div class="modal-body">

                <form class="form-horizontal" id="product-form">
                    <div class="row">
                       <div class="form-group">
                            <label class="col-sm-2 control-label">员工帐号</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="admin" readonly="readonly">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">员工姓名</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="name">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">手机号</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="phoneNum">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">家庭住址</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="address">
                            </div>
                        </div>

					<!--  
                        <div class="form-group">
                            <label class="col-sm-2 control-label">权限修改</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="permission">
                                    <option>领导</option>
                                    <option>业务员</option>
                                    <option>安全人员</option>
                                </select>
                            </div>
                        </div>
                      -->
                        
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                <button type="button" onclick="updateUser();" class="btn btn-danger">修 改</button>
            </div>
        </div>
    </div>
</div>

<!-- 警告对话框 -->
<div class="modal fade" id="alertdialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header blue">
                <div>
                    <strong id="alertchar" style="font-size:20px"></strong>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" id="commitFoodDataButton" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

$('#edit').on('click', function () {
    var array = $('#table').bootstrapTable('getSelections');
    tag = 1;

    if (array.length > 1) {
        $('#alertchar').text('编辑操作不能同时选中多条记录！');
        $('#commitFoodDataButton').hide();
        $('#alertdialog').modal("show");
    } else if (array.length == 0) {
        $('#alertchar').text('请先选中某条记录！');
        $('#commitFoodDataButton').hide();
        $('#alertdialog').modal("show");
    } else {
        
    	var campusAdmin = array[0].campusAdmin;
    	var name = array[0].name;
    	var telePhone=array[0].telePhone;
    	var address=array[0].address;
    	
    	$("#admin").val(campusAdmin);
    	$("#name").val(name);
    	$("#phoneNum").val(telePhone);
    	$("#address").val(address);
        $("#myModal").modal('show');

    }
});

   function updateUser(){
	   
	   var campusAdmin = $("#admin").val();
   	   var name = $("#name").val();
   	   var telePhone=$("#phoneNum").val();
   	   var address=$("#address").val();
   	   
   		$.post("/zc/user/updateUser.do", {
   			campusAdmin:campusAdmin,
   			name :name,
   			telePhone:telePhone,
   			address:address
		}, function(text) {
			if(text==1){
				var url="/zc/user/getAllUser.do";

	    		$(" #table").bootstrapTable('refresh',{
					url : url
				});
	    		$("#myModal").modal('hide');
			}else{
				$("#myModal").modal('hide');
				alert("更新失败");
			}
    	});
    }
   
   
   $('#delete').click(function () {
       var array = $('#table').bootstrapTable('getSelections'); //获取选中的所有记录
       console.log(array);
       var CampusAdmins = "";
       var deltext = "";
       if (array.length == 0) {

           $('#alertchar').text('请先选中要删除的记录！');
           $('#commitFoodDataButton').hide();
           $('#alertdialog').modal("show");

       } else {
           for (var i = array.length - 1; i >= 0; i--) {
               if (i == 0) {
            	   CampusAdmins += array[i].campusAdmin; //连接最末不加，号
                   deltext += array[i].campusAdmin;
               } else {
            	   CampusAdmins += array[i].campusAdmin + ","; //id用逗号连接
                   deltext += array[i].campusAdmin + ",";
               }
           }


           var foodtext = '是否确定要删除 ' + deltext + ' ? ';

           $('#alertchar').text(foodtext);
           $('#commitFoodDataButton').show();
           $('#alertdialog').modal("show");

           $('#commitFoodDataButton').click(function () {
               //做删除的访问请求
               $.post("/zc/user/deleteUser.do", {
            	   CampusAdmins: CampusAdmins
               }, function (text) {
                   if (text == 1) {
                       /*
                        * 刷新页面
                        */
                        var url="/zc/user/getAllUser.do";
                       $(" #table").bootstrapTable('refresh', {
                           url: url
                       });

                       $('#alertchar').text("删除成功");
                       setTimeout(function () {
                           $('#alertdialog').modal("hide");
                       }, 1000);
                   } else if (text = 2) {
                       $('#alertchar').text("已经录入客户的员工不能删除");
                   } else {
                       $('#alertchar').text("删除失败");
                       setTimeout(function () {
                           $('#alertdialog').modal("hide");
                       }, 1000);
                   }
               });
           });
       }
   });
   
    var campusId=1;

    function statusSex(value, row, index) {
        if (value == "0")
            return "?";
        else if (value == "1") {
            return "男";
        }else if (value == "2") {
            return "女";
        }
    }

    function actionStatus(value, row, index){
        if (value == "1") {
            return "<img src='../img/right.jpg' width='15px' height='13px' title='允许'></i>";
        }else if(value=="2"){
            return "<img src='../img/wrong.jpg' width='13px' height='13px' title='不允许'></i>";
        }
    }

    function actionTime(value, row, index){
        var date = new Date(value);
        Y = date.getFullYear() + '-';
        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        D = date.getDate() + ' ';
        h = date.getHours() + ':';
        m = date.getMinutes() + ':';
        s = date.getSeconds();
        return Y+M+D+h+m+s;
    }

    function statusFormatter(value, row, index) {
        if (value == "1") {
            return "允许";
        }else if (value == "2") {
            return "不允许";
        }
    }

    function actionFormatter(value, row, index) {

        return [
            '<a class="superAdmin ml8 fa fa-user-plus" href="javascript:void(0)" title="设为允许登陆">',
            '&nbsp;&nbsp;',
            '</a>',
            '<a class="admin ml8 fa fa-user" href="javascript:void(0)" title="设为不允许登陆">',
            '&nbsp;&nbsp;',
            '</a>'].join('');

    }

    window.actionEvents = {
        'click .superAdmin' : function(e, value, row, index) {
            //alert("admin");
            $.post("../../zc/user/upAtionFormatter.do", {
                campusAdmin : row.campusAdmin,
                state:1,

            }, function(text) {

                if (text == -1 || text == 0) {
                    setSuccess("设置为领导失败。");
                } else {
                    setSuccess("设置为领导成功。");
                    $('#table').bootstrapTable('updateRow', {
                        index : index,
                        row : {
                            type : 2
                        }
                    });
                    $('#table').bootstrapTable('refresh', {silent: true});
                }

            });
        },
        'click .admin' : function(e, value, row, index) {
            //alert("common");
            $.post("../../zc/user/upAtionFormatter.do", {
                campusAdmin : row.campusAdmin,
                state:2,
            }, function(text) {
                if (text == -1 || text == 0) {
                    setSuccess("设置为安全人员失败。");
                } else {
                    setSuccess("设置为安全人员成功。");
                    $('#table').bootstrapTable('updateRow', {
                        index : index,
                        row : {
                            type : 1
                        }
                    });
                    $('#table').bootstrapTable('refresh', {silent: true});
                }

            });
        }
    };

</script>
</body>
</html>
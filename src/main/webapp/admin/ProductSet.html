
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta content="" name="description"/>
    <meta content="webthemez" name="author"/>
    <title>中泸财务</title>
    <script src="../assets/js/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet"
          href="../assets/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet"
          href="../assets/bootstrap-table/bootstrap-editable.css">
    <script src="../assets/bootstrap-table/jquery.min.js"></script>
    <link rel="stylesheet" href="../assets/bootstrap-table/bootstrap.min.css">
    <script src="../assets/bootstrap-table/bootstrap-table.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-table-export.js"></script>
    <script src="../assets/bootstrap-table/tableExport.js"></script>
    <script src="../assets/bootstrap-table/bootstrap-table-editable.js"></script>

    <script src="../js/bootstrap-table-zh-CN.min.js"></script>
    <script type="text/javascript" src="../bootstrap/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <!-- Bootstrap Js -->
    <script src="../assets/js/bootstrap.min.js"></script>
    <!-- Metis Menu Js -->
    <script src="../assets/js/jquery.metisMenu.js"></script>
    <!-- Custom Js -->
    <script src="../assets/js/custom-scripts.js"></script>
    <script src="../assets/js/select2.full.min.js"></script>
    <!-- Bootstrap Styles-->
    <link href="../assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="../assets/css/font-awesome.css" rel="stylesheet"/>
    <link href="../assets/css/checkbox3.min.css" rel="stylesheet">
    <!-- Morris Chart Styles-->
    <link href="../assets/js/morris/morris-0.4.3.min.css" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="../assets/css/custom-styles.css" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../assets/js/Lightweight-Chart/cssCharts.css">

</head>

<body>
<div id="wrapper">
    <nav class="navbar navbar-default top-navbar" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="Main.html"><strong><i class="icon fa fa-plane"></i>中泸财务</strong></a>
        </div>

        <ul class="nav navbar-top-links navbar-right">
            <!-- /.dropdown -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="/zc/updateUser.html"><i class="fa fa-sign-out fa-fw"></i> 密码设置</a>
                    </li>
                    <li><a href="/zc/user/logout.do"><i class="fa fa-sign-out fa-fw"></i> 退出登录</a>
                    </li>
                </ul>
                <!-- /.dropdown-user -->
            </li>
            <!-- /.dropdown -->
        </ul>
    </nav>
    <!--/. NAV TOP  -->
   <nav class="navbar-default navbar-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav" id="main-menu">
                <li>
                    <a href="#"><i class="fa fa-sitemap"></i> 客户信息<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li>
                            <a href="../Main.html">客户列表信息</a>
                        </li>
                        <li>
                            <a href="../AddInfo.html">添加客户信息</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-sitemap"></i> 贷款管理<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="../passLoanDeal.html">已 通 过</a></li>
                        <li><a href="../notLoanDeal.html">未 通 过</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-sitemap"></i> 还款管理<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li><a href="../needRepayment.html">未 完 成</a></li>
                        <li><a href="../successRepayment.html">已 完 成</a></li>
                        <li><a href="../overdueRepayment.html">已 逾 期</a></li>
                    </ul>
                </li>
                <li id="userhide">
                    <a href="#"><i class="fa fa-sitemap"></i> 系统设置<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                             <li ><a href="user.html">员工管理信息</a></li>
                             <li><a href="ProductSet.html"></i> 产 品 设 置</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
    <!-- /. NAV SIDE  -->
    <div id="page-wrapper">
        <!-- /. PAGE WRAPPER  -->
        <div class="header">
            <h1 class="page-header">产品设置</h1>
        </div>


        <div id="page-inner">
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="card-title">
                                <div class="title">产品信息</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="table-responsive">
                                <div id="toolbar" class="btn-group">
                                    <button id="plus" type="button" class="btn btn-default">
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新 增
                                    </button>
                                    <button id="delete" type="button" class="btn btn-default">
                                        <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>删 除
                                    </button>
                                </div>
                                <table id="table" class="table " data-toggle="table" data-toolbar="#toolbar"
                                       data-url="../loan/getAllProduct.do" data-search="true"
                                       data-show-refresh="true" data-show-toggle="true"
                                       data-side-pagination="server" data-pagination="true"
                                       data-show-columns="true" data-sort-order="desc">
                                    <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true"></th>
                                        <th data-align="left" data-field="id">id</th>
                                        <th data-align="left" data-field="proName">产品名称</th>
                                        <th data-align="left" data-field="money" data-formatter="actionInterest">贷款金额</th>
                                        <th data-align="left" data-field="nper" >期数</th>
                                        <th data-align="left" data-field="cycle" data-formatter="actionCycle">周期长度</th>
                                        <th data-align="left" data-field="should_repay" data-formatter="actionInterest">应还款总额</th>
                                        <th data-align="left" data-field="stage" data-formatter="actionInterest">每期应还本金</th>
                                        <th data-align="left" data-field="interest" data-formatter="actionInterest">每期利息</th>
                                        <th data-align="left" data-field="datetime" data-formatter="actionTime">产品创建日期</th>
                                        <th data-align="left" data-field="pro_GUID">产品编号</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>

 <!--对话框-->
<div class="modal fade" id="myDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <h3 class="modal-title" id="myModalLabel">产品添加</h3>
            <div class="modal-body">

                <form class="form-horizontal" id="product-form">
                    <div class="row">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">产品名称</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="proName"
                                       placeholder="产品名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">贷款金额</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="proMoney"
                                       placeholder="贷款金额">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">期数</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="nper">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">周期长度</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="cycle">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">每期利息</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="interest">
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                    <button type="button" onclick="commitDataButton();" class="btn btn-primary">添 加</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 删除对话框 -->
<div class="modal fade" id="deldialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
             		   警 告
            </div>
            <div class="modal-body">确定要删除这条语句？</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                    <button type="button" id="deleteBtn" class="btn btn-danger">确 定</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 警告对话框 -->
<div class="modal fade" id="alertdialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header blue">
                <div>
                    <strong id="alertchar" style="font-size:20px"></strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
                    <button type="button" id="commitFoodDataButton" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var i = 1;
    for (i = 1; i <= 30; i++) {
        $("#nper").append("<option value='" + i + "'>" + i + "</option>");
        $("#cycle").append("<option value='" + i + "'>" + i + " 天</option>");
    }
    for (var a = 1; a <= 500; a++) {
        $("#interest").append("<option value='" + a  + "'>" + a  + " 元 </option>");
    }
    function getcookie(name) {
        var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg))
            return unescape(arr[2]);
        else
            return null;
    }

    var type = getcookie('type');

    if (type != 0) {
        $("#userhide").hide();
    }

    function commitDataButton(){
    	var name = $('#proName').val().toString();
        var money = $('#proMoney').val().toString();
        var nper = $('#nper').val().toString();
        var cycle = $('#cycle').val().toString();
        var interest =  $('#interest').val().toString();
        
        if(name==""){
        	alert("产品名称不能空!");
	    	return;
        }
        
        if(money==""){
        	alert("金额不能空!");
	    	return;
        }
        
        if(!(/^\d+(\.\d{1,2})?$/).test(money)){
	    	alert("金额只能为数字,检查后重新输入!");
	    	return;
	    }
        
        var product=new Object();
		
		product.name=name;
		product.money=money;
		product.nper=nper;
		product.cycle=cycle;
		product.interest=interest;
        
		var productData=JSON.stringify(product);
		
        $.post("../loan/insertProduct.do", {
        	productData : productData
		}, function(text) {
              if(text==1){
            	  alert("添加成功");
            	  
            	  var url="../loan/getAllProduct.do";

            	  $('#myDialog').modal("hide");
            	  
			       $(" #table").bootstrapTable('refresh',{
					 url : url
				   });
			        
              }else{
            	  alert("添加失败");
              }
		});
    }
    
    $('#plus').click(function () {  	
        $('#myDialog').modal("show");
        
    });
    

    $('#edit').on('click', function () {
        var array = $('#table').bootstrapTable('getSelections');
        tag = 1;
        if (array.length > 1) {
            $('#alertchar').text('编辑操作不能同时选中多条记录！');
            $('#commitFoodDataButton').hide();
            $('#alertdialog').modal("show");
        } else if (array.length == 0) {
            $('#alertchar').text('请先选中某条记录！');
            $('#commitFoodDataButton').hide();
            $('#alertdialog').modal("show");
        } else {
        	$("#myModalLabel").text("编辑产品");
            $("#myDialog").modal('show');

            // top.location.href = "UpdateInfo.html?uuid=" + array[0].guid;
            /*
            var status=document.getElementsByName("status")
            status[1-array[0].status].checked=true;
            */
        }
    });


    $('#delete').click(function () {
    	var array = $('#table').bootstrapTable('getSelections'); //获取选中的所有记录
    	console.log(array);
    	var foodIdString = "";
    	var deltext="";
    	if (array.length == 0){

    			$('#alertchar').text('请先选中要删除的记录！');
    			$('#commitFoodDataButton').hide();
    			$('#alertdialog').modal("show");

    	}else {
    		for ( var i = array.length - 1; i >= 0; i--) {
    			if (i == 0) {
    				foodIdString += array[i].pro_GUID; //连接最末不加，号
    				deltext+=array[i].proName;
    			} else {
    				foodIdString += array[i].pro_GUID + ","; //id用逗号连接
    				deltext+=array[i].proName+",";
    			}
    		}
            

    		var foodtext='是否确定要删除 '+deltext+' ? ';
    		
    		$('#alertchar').text(foodtext);
    		$('#commitFoodDataButton').show();
    		$('#alertdialog').modal("show");
    		
    		$('#commitFoodDataButton').click(function(){
    			//做删除的访问请求
    			$.post("../loan/delProduct.do", {
    				pro_GUIDs : foodIdString
    			}, function(text) {
    				if (text == 1) {				    						
    						/*
    						 * 刷新页面
    						 */
    						 var url="../loan/getAllProduct.do";
    				    	$(" #table").bootstrapTable('refresh',{
    							url : url
    						});
    				    	
    					$('#alertchar').text("删除成功");
    					setTimeout(function(){
    						$('#alertdialog').modal("hide");
    					},1000);
    				}else if(text=2){
    					$('#alertchar').text("正在使用的产品不能删除");
    				} else {
    					$('#alertchar').text("删除失败");
    					setTimeout(function(){
    						 $('#alertdialog').modal("hide");
    						},1000);
    				}
    			});
    		});
    	}
    });
    
    
    function actionTime(value, row, index){
        var date = new Date(value);
        Y = date.getFullYear() + '-';
        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        D = date.getDate() + ' ';
        h = date.getHours() + ':';
        m = date.getMinutes() + ':';
        s = date.getSeconds();
        return Y+M+D+h+m+s;
    }

    
    function actionInterest(value, row, index){
    	var text=value+" 元";
    	return text;
    }
    
    function actionCycle(value, row, index){
    	var text=value+" 天";
    	return text;
    }
    
</script>
</body>

</html>
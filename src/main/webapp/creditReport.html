<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta content="" name="description"/>
    <meta content="webthemez" name="author"/>
    <title>中财财务</title>
    <script src="assets/js/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet"
          href="assets/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet"
          href="assets/bootstrap-table/bootstrap-editable.css">
    <script src="assets/bootstrap-table/jquery.min.js"></script>
    <link rel="stylesheet" href="assets/bootstrap-table/bootstrap.min.css">
    <script src="assets/bootstrap-table/bootstrap-table.js"></script>
    <script src="assets/bootstrap-table/bootstrap-table-export.js"></script>
    <script src="assets/bootstrap-table/tableExport.js"></script>
    <script src="assets/bootstrap-table/bootstrap-table-editable.js"></script>

    <script src="js/bootstrap-table-zh-CN.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
    <!-- Bootstrap Js -->
    <script src="assets/js/bootstrap.min.js"></script>
    <!-- Metis Menu Js -->
    <script src="assets/js/jquery.metisMenu.js"></script>
    <!-- Custom Js -->
    <script src="assets/js/custom-scripts.js"></script>
    <script src="assets/js/select2.full.min.js"></script>
    <!-- DATA TABLE SCRIPTS -->
    <script src="assets/js/dataTables/jquery.dataTables.js"></script>
    <script src="assets/js/dataTables/dataTables.bootstrap.js"></script>
    <script src="assets/js/form-validator/form-validator.js"></script>

    <!-- Bootstrap Styles-->
    <link href="assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="assets/css/font-awesome.css" rel="stylesheet"/>
    <link href="assets/css/checkbox3.min.css" rel="stylesheet">
    <!-- Morris Chart Styles-->

    <!-- Custom Styles-->
    <link href="assets/css/custom-styles1.css" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="assets/js/Lightweight-Chart/cssCharts.css">

</head>

<body>
        <div class="header">
            <h1 class="page-header">征信查询</h1>
        </div>
        <div id="page-inner">
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="card-title">
                                <div id="a" class="title">运营商信用报告查询(  注意:查询期间禁止刷新页面 ! )</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form class="form-horizontal" id="userinfo-form">
                                <div class="row">
                                    <div class="form-group col-sm-2">
                                        <label class="col-sm-3 control-label">用户名</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="username"
                                                   id="username" placeholder="用户名">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-3 control-label">身份证号</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="identityName"
                                                   id="identityCardNo"
                                                   placeholder="身份证号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-3 control-label">手机号</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="identityName"
                                                   id="userPhoneNum"
                                                   placeholder="填入手机号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-2">
                                        <label class="col-sm-3 control-label">服务密码</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="password" id="password"
                                                   placeholder="服务密码">
                                        </div>
                                    </div>                                                       
                                    <div class="form-group col-sm-2">
                                        <button type="button" id="start" class="btn btn-success">查询</button>
                                    </div>
                                </div>
                                <div class="row">
                                    <div id="control" class="form-group col-sm-6">
                                        <label class="control-label col-sm-3" for="phone">输入短信验证码</label>
                                        <div class="controls col-sm-4">
                                            <input class="form-control" type="text" id="sms" placeholder="短信验证码">
                                        </div>
                                        <div class="controls col-sm-4">
                                            <button type="button" id="input" class="btn btn-success">ipnut</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">

                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="card-title">
                                <div class="title">紧急联系人</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form class="form-horizontal" id="contact-form">
                                <div class="row">
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系人姓名</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactName1st" placeholder="第一联系人姓名">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系人身份证号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactIdentityNo1st"
                                                   placeholder="第一联系人身份证号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系人手机号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="identityName"
                                                   id="contactMobile1st"
                                                   placeholder="第一联系人手机号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系社会关系</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="contactRelationship1st">
                                                <option>父亲</option>
                                                <option>母亲</option>
                                                <option>配偶</option>
                                                <option>子女</option>
                                                <option>其他亲属</option>
                                                <option>朋友</option>
                                                <option>同事</option>
                                                <option>其他</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第二联系人姓名</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactName2nd" placeholder="第二联系人姓名">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第二联系人身份证号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactIdentityNo2nd"
                                                   placeholder="第二联系人身份证号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第二联系人手机号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="identityName"
                                                   id="contactMobile2nd"
                                                   placeholder="第二联系人手机号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第二联系社会关系</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="contactRelationship2nd">
                                                <option>父亲</option>
                                                <option>母亲</option>
                                                <option>配偶</option>
                                                <option>子女</option>
                                                <option>其他亲属</option>
                                                <option>朋友</option>
                                                <option>同事</option>
                                                <option>其他</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系人姓名</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactName3rd" placeholder="第三联系人姓名">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第一联系人身份证号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control"
                                                   id="contactIdentityNo3rd"
                                                   placeholder="第三联系人身份证号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第三联系人手机号</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="identityName"
                                                   id="contactMobile3rd"
                                                   placeholder="第三联系人手机号">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-3">
                                        <label class="col-sm-4 control-label">第三联系社会关系</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="contactRelationship3rd">
                                                <option>父亲</option>
                                                <option>母亲</option>
                                                <option>配偶</option>
                                                <option>子女</option>
                                                <option>其他亲属</option>
                                                <option>朋友</option>
                                                <option>同事</option>
                                                <option>其他</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>

</body>
</html>
<script type="text/javascript">

function getQueryString(key){
    var reg = new RegExp("(^|&)"+key+"=([^&]*)(&|$)");
    var result = window.location.search.substr(1).match(reg);
    return result?decodeURIComponent(result[2]):null;
  }

  var useridCard=getQueryString("useridCard");
  var userName=getQueryString("userName");
  var userPhoneNum=getQueryString("userPhoneNum");

  $("#username").val(userName);  
  $("#identityCardNo").val(useridCard);
  $("#userPhoneNum").val(userPhoneNum);
  
   var control = document.getElementById("control");

    control.style.display = "none";   
    
    $("#start").click(function () {
  	
        var username=$("#username").val().toString(); 
        var userPhoneNum=$("#userPhoneNum").val().toString(); 
        var identityCardNo=$("#identityCardNo").val().toString(); 
        var password=$("#password").val().toString();
        var clientInfo = new Object();

        clientInfo.contactName1st=$("#contactName1st").val().toString();
        clientInfo.contactIdentityNo1st=$("#contactIdentityNo1st").val().toString();
        clientInfo.contactMobile1st=$("#contactMobile1st").val().toString();
        clientInfo.contactRelationship1st=$("#contactRelationship1st").val().toString();

        clientInfo.contactName2nd=$("#contactName2nd").val().toString();
        clientInfo.contactIdentityNo2nd=$("#contactIdentityNo2nd").val().toString();
        clientInfo.contactMobile2nd=$("#contactMobile2nd").val().toString();
        clientInfo.contactRelationship2nd=$("#contactRelationship2nd").val().toString();

        clientInfo.contactName3rd=$("#contactName3rd").val().toString();
        clientInfo.contactIdentityNo3rd=$("#contactIdentityNo3rd").val().toString();
        clientInfo.contactMobile3rd=$("#contactMobile3rd").val().toString();
        clientInfo.contactRelationship3rd=$("#contactRelationship3rd").val().toString();
        var clientInfodata = JSON.stringify(clientInfo);

        if(password==""){
        	alert("密码不能为空!");
        	return false;
        }
        
        $.post("/zc/credit/taskMobile.do", {            
        	username:userPhoneNum,
			identityName:username,
			identityCardNo:identityCardNo,
			password:password,
			clientInfo:clientInfodata
        }, function (text) {
            var json = $.parseJSON(text);
            $("#a").text(json.msg);
            if (json.code == "0010") {
            	
                alert(json.msg);
                var token = json.token;
                console.log("token="+token);
                var startButton = document.getElementById("start");
                startButton.style.display = "none";
                
                $("#input").on("click", function () {
                    var input = $("#sms").val();
                    control.style.display = "none"; 
                    $("#sms").val("");
                    $.post("/zc/credit/input.do", {                    
                        json:text,
                        s: input
                    }, function (text) {
                    	var json = $.parseJSON(text);
                    	alert(json.msg);
                    });
                });
                       
                setTimeout(function(){	  
              		$.post("/zc/credit/status.do", {
                        token:token,
                    	username:userPhoneNum,
            			identityName:username,
            			identityCardNo:identityCardNo,
            			password:password
                    }, function (text) {
                    	var json = $.parseJSON(text);
                    	if(json.code!=""){
                         if (json.code == "0006") {
                        	control.style.display = "";
                         }else if(json.code == "0200"){
                            alert(json.msg);
                         }else if (json.code == "0000") {
                            alert("获取报告成功");
                          /*  window.location.href = "mobileReportList.html?useridCard=" + useridCard+
                    		"&userName="+userName+"&userPhoneNum="+userPhoneNum;
                          */
                            var uuid=json.uuid;
                            window.location.href = "mobileReport.html?uuid="+uuid;
                          }else{
                        	  alert(json.msg);
                              $("#a").text(json.msg);
                          }
                        }
                    });
              		
              		 setTimeout(arguments.callee,3000);
              		 
              	  },50);

            } else {
                alert(json.msg);
                $("#a").text(json.msg);
            }
        });

    });


</script>
